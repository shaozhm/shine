'use strict';

const deployTasksClass = require('./deploy-tasks-manager'),
      async = require('async');


class IndependentDeploy {
    constructor(options) {
        options.deploymentType = 'independentApp';
        this.tasks = new deployTasksClass(options);
    }

    deploy() {
        return new Promise((resolve, reject) => {

            try {
                console.log('Start deploying Independent app ...')
                var tasksArray = [];
                tasksArray.push(this.tasks.readDestinationsTask.bind(this.tasks));
                tasksArray.push(this.tasks.readEnvironmentVariablesTask.bind(this.tasks));
                tasksArray.push(this.tasks.archiveProject.bind(this.tasks));
                tasksArray.push(this.tasks.deploy.bind(this.tasks));

                async.waterfall(tasksArray, (err) => {
                    if (err) {
                        reject(err);
                    } else {
                        resolve();
                    }
                });
            } catch(err) {
                reject(err);
            }
        });
    }
}

module.exports = IndependentDeploy;

